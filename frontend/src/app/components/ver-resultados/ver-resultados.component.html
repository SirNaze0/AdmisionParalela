<app-layout>
  <div class="page-header">
    <div class="header-content">
      <div>
        <h1>Resultados de Exámenes</h1>
        <p>Consulte y descargue los resultados de los exámenes corregidos</p>
      </div>
    </div>
  </div>

  <!-- Estadísticas -->
  <div *ngIf="resultados && !cargando" class="stats-card">
    <div class="card-header">
      <div class="card-icon primary">
        <fa-icon [icon]="faChartBar" style="color: white; font-size: 20px;"></fa-icon>
      </div>
      <h3>Resumen de Resultados</h3>
    </div>
    
    <div class="stats-content">
      <div class="stat-item">
        <div class="stat-number">{{ resultados.totalResultados }}</div>
        <div class="stat-label">Total de Resultados</div>
      </div>
      
      <div class="stat-item" *ngIf="areaSeleccionada">
        <div class="stat-number area-badge" [class]="'area-' + areaSeleccionada.toLowerCase()">{{ areaSeleccionada }}</div>
        <div class="stat-label">Área Seleccionada</div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <div class="card-header">
      <div class="card-icon success">
        <fa-icon [icon]="faFilter" style="color: white; font-size: 20px;"></fa-icon>
      </div>
      <h3>Filtros</h3>
    </div>
    
    <div class="filters-content">
      <div class="filter-group">
        <label for="area-select">Filtrar por área:</label>
        <select 
          id="area-select"
          [(ngModel)]="areaSeleccionada"
          (change)="onAreaChange()"
          class="filter-select">
          <option value="">Todas las áreas</option>
          <option *ngFor="let area of areas" [value]="area">Área {{ area }}</option>
        </select>
      </div>
      
      <div class="filter-actions">
        <button class="btn-clear" (click)="limpiarFiltros()">
          Limpiar Filtros
        </button>
        
        <button 
          class="btn-download" 
          [class.disabled]="descargandoPDF"
          [disabled]="descargandoPDF"
          (click)="descargarPDF()">
          <fa-icon *ngIf="descargandoPDF" [icon]="faSpinner" [spin]="true" style="margin-right: 8px;"></fa-icon>
          <fa-icon *ngIf="!descargandoPDF" [icon]="faDownload" style="margin-right: 8px;"></fa-icon>
          <span *ngIf="!descargandoPDF">Descargar PDF</span>
          <span *ngIf="descargandoPDF">Generando...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla de Resultados -->
  <div class="results-table-card" *ngIf="!cargando">
    <div class="card-header">
      <div class="card-icon primary">
        <fa-icon [icon]="faTable" style="color: white; font-size: 20px;"></fa-icon>
      </div>
      <h3>Tabla de Resultados</h3>
    </div>
    
    <div *ngIf="resultados && resultados.resultados && resultados.resultados.length > 0" class="table-container">
      <table class="results-table">
        <thead>
          <tr>
            <th>Posición</th>
            <th>Postulante</th>
            <th>Área</th>
            <th>Nota</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let resultado of resultados.resultados; index as i" class="table-row">
            <td class="position">{{ i + 1 }}</td>
            <td class="postulante">{{ resultado.postulanteId || resultado.codigoPostulante || 'N/A' }}</td>
            <td class="area">
              <span class="area-badge" [class]="'area-' + (resultado.area || 'unknown').toLowerCase()">
                {{ resultado.area || 'N/A' }}
              </span>
            </td>
            <td class="nota" [class.nota-alta]="resultado.nota >= 80" [class.nota-media]="resultado.nota >= 60 && resultado.nota < 80" [class.nota-baja]="resultado.nota < 60">
              {{ resultado.nota }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div *ngIf="resultados && (!resultados.resultados || resultados.resultados.length === 0)" class="empty-state">
      <fa-icon [icon]="faTable" style="font-size: 120px; opacity: 0.3; color: #a098ae;"></fa-icon>
      <h3>No hay resultados</h3>
      <p>No se encontraron resultados {{ areaSeleccionada ? 'para el área ' + areaSeleccionada : '' }}</p>
      <p><em>Asegúrese de haber procesado fichas ópticas previamente</em></p>
    </div>
    
    <div *ngIf="resultados?.mensaje" class="message-info">
      <p>{{ resultados?.mensaje || '' }}</p>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="loading-section">
    <div class="loading-spinner"></div>
    <p>Cargando resultados...</p>
  </div>
</app-layout>
