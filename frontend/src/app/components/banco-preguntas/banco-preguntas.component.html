<app-layout>
  <div class="page-header">
    <div class="header-content">
      <div>
        <h1>Gestión del Banco de Preguntas</h1>
        <p>Administre las preguntas disponibles para la generación de exámenes</p>
      </div>
      <button class="btn-add-question" (click)="abrirModalAgregarPregunta()">
        <fa-icon [icon]="faPlus"></fa-icon>
        Agregar Pregunta
      </button>
    </div>
  </div>

    <!-- Estadísticas -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon primary">
          <fa-icon [icon]="faBook" style="color: white; font-size: 24px;"></fa-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ estadisticas.totalPreguntas }}</div>
          <div class="stat-label">Total de Preguntas</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon success">
          <fa-icon [icon]="faQuestionCircle" style="color: white; font-size: 24px;"></fa-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ estadisticas.cursosDisponibles }}</div>
          <div class="stat-label">Cursos Disponibles</div>
        </div>
      </div>
    </div>

    <!-- Filtros y Búsqueda -->
    <div class="filters-card">
      <h3>Filtros y Búsqueda</h3>
      
      <div class="filters-row">
        <div class="search-group">
          <fa-icon [icon]="faSearch" class="search-icon"></fa-icon>
          <input 
            type="text" 
            placeholder="Buscar preguntas..."
            [(ngModel)]="filtros.busqueda"
            (input)="onFiltroChange()"
            class="search-input">
        </div>
        
        <select 
          [(ngModel)]="filtros.curso"
          (change)="onFiltroChange()"
          class="filter-select">
          <option value="">Todos los cursos</option>
          <option *ngFor="let curso of cursosDisponibles" [value]="curso">{{ curso }}</option>
        </select>
        
        <button class="btn-clear-filters" (click)="limpiarFiltros()">
          Limpiar Filtros
        </button>
      </div>
    </div>

    <!-- Tabla de Preguntas -->
    <div class="questions-table-card">
      <div class="table-header">
        <div class="header-cell">Enunciado</div>
        <div class="header-cell">Curso</div>
      </div>
      
      <div *ngIf="cargando" class="loading-row">
        <div class="loading-spinner"></div>
        <p>Cargando preguntas...</p>
      </div>
      
      <div *ngFor="let pregunta of preguntasFiltradas" class="table-row">
        <div class="table-cell question-cell">
          <p class="question-text">{{ pregunta.enunciado }}</p>
        </div>
        
        <div class="table-cell">
          <span class="tag tag-curso">{{ pregunta.curso }}</span>
        </div>
      </div>
      
      <div *ngIf="preguntasFiltradas.length === 0 && !cargando" class="empty-state">
        <fa-icon [icon]="faBook" style="font-size: 120px; opacity: 0.3; color: #a098ae;"></fa-icon>
        <h3>No se encontraron preguntas</h3>
        <p>No hay preguntas que coincidan con los filtros seleccionados</p>
      </div>
    </div>

    <!-- Acciones -->
    <div class="additional-actions">
      <div class="upload-section">
        <label for="archivo-preguntas" class="btn-upload">
          <fa-icon [icon]="faUpload"></fa-icon>
          Subir Archivo CSV
        </label>
        <input 
          id="archivo-preguntas"
          type="file" 
          accept=".csv"
          (change)="subirArchivo($event)"
          style="display: none;">
      </div>
      
      <button class="btn-clear-bank" (click)="limpiarBanco()">
        <fa-icon [icon]="faTrash"></fa-icon>
        Limpiar Banco
      </button>
    </div>

  <!-- Modal para agregar/editar pregunta -->
  <div *ngIf="mostrarModal" class="modal-overlay" (click)="cerrarModal()" (keydown)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editandoPregunta ? 'Editar Pregunta' : 'Agregar Nueva Pregunta' }}</h2>
        <button class="btn-close" (click)="cerrarModal()">×</button>
      </div>
      
      <form class="question-form" (ngSubmit)="guardarPregunta()">
        <div class="form-group">
          <label for="enunciado">Enunciado de la pregunta:</label>
          <textarea 
            id="enunciado"
            [(ngModel)]="preguntaFormulario.enunciado" 
            name="enunciado"
            class="form-textarea"
            rows="3"
            placeholder="Ingrese el enunciado de la pregunta..."
            required></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="curso">Curso:</label>
            <select 
              id="curso"
              [(ngModel)]="preguntaFormulario.curso" 
              name="curso"
              class="form-select"
              required>
              <option value="">Seleccione un curso</option>
              <option value="Matemática">Matemática</option>
              <option value="Comunicación">Comunicación</option>
              <option value="Historia">Historia</option>
              <option value="Geografía">Geografía</option>
              <option value="Economía">Economía</option>
              <option value="Filosofía">Filosofía</option>
              <option value="Física">Física</option>
              <option value="Química">Química</option>
              <option value="Biología">Biología</option>
            </select>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
          <button type="submit" class="btn-save" [disabled]="!preguntaFormulario.enunciado || !preguntaFormulario.curso">
            {{ editandoPregunta ? 'Actualizar' : 'Agregar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</app-layout>